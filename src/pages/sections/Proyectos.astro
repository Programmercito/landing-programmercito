---
import BordeadoIcon from "../../components/opciones/BordeadoIcon.astro";
import Chip from "../../components/opciones/Chip.astro";
import Subtitle from "../../components/opciones/Subtitle.astro";
import TitleSection from "../../components/opciones/TitleSection.astro";
import Section from "../../components/Section.astro";
import links from "../../data/proyectos.json";
import CodeIcon from "../../components/icons/CodeIcon.astro";
import DeployIcon from "../../components/icons/DeployIcon.astro";
---

<Section id="proyectos">
  <!-- Texto y botones -->
  <div class="order-2 md:order-1 text-center md:text-left">
    <TitleSection>Proyectos</TitleSection>

    <div class="grid gap-8 md:grid-cols-2 items-stretch">
      {
        links.map((link, idx) => (
          <div class="w-full h-full flex">
            <div class="flex flex-col p-3 rounded-lg shadow-2xl w-full h-full transition-all duration-300 group hover:shadow-[0_8px_32px_0_rgba(0,0,0,0.35)] hover:scale-105">
              <>
                <div>
                  <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                    <div>
                      <Subtitle>{link.name}</Subtitle>
                    </div>
                  </div>
                  <p class="text-justify [text-justify:inter-word]">
                    {link.description}
                  </p>
                </div>
                <div>
                  <div class="flex flex-wrap justify-center items-start gap-2">
                    {link.images?.map((img, index) => {
                      return (
                        <a href="#!" onclick={`abrirPopup('${img}')`}>
                          <img
                            src={img}
                            alt={link.name}
                            class="w-[70px] h-auto"
                          />
                        </a>
                      );
                    })}
                  </div>
                </div>
                <div>
                  {link.tech && link.tech.length > 0 && (
                    <div class="flex flex-wrap gap-2 mt-3 justify-center">
                      {link.tech.map((tec) => (
                        <Chip text={tec} />
                      ))}
                    </div>
                  )}
                </div>
              </>
              <div class="flex flex-col items-center justify-center gap-4 md:flex-row md:justify-center mt-4">
                <BordeadoIcon link={link.url} target="_self">
                  <CodeIcon />
                  Código
                </BordeadoIcon>
                {link.despliegue && (
                  <BordeadoIcon link={link.despliegue}>
                    <DeployIcon />
                    Demo o despliegue
                  </BordeadoIcon>
                )}
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
  <dialog id="mimodal" class="bg-bg-200 border border-primary-200 rounded-lg shadow-2xl backdrop:bg-black/50 p-4 max-w-3xl">
    <img
      id="imagen-popup"
      src=""
      alt="Imagen del proyecto"
      class="w-full h-auto object-contain max-h-[70vh] rounded"
    />
    <button onclick="cerrarPopup()" class="absolute top-2 right-2 p-1 bg-bg-300 rounded-full text-text-100 hover:bg-primary-100 hover:scale-110 transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </dialog>
</Section>
<script is:inline>
  function abrirPopup(src) {
    // asigna la imagen al <img>
    document.getElementById("imagen-popup").src = src;
    // abre el diálogo
    document.getElementById("mimodal").showModal();
  }

  function cerrarPopup() {
    document.getElementById("mimodal").close();
  }
</script>
