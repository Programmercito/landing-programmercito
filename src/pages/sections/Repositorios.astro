---
import BordeadoIcon from "../../components/opciones/BordeadoIcon.astro";
import Chip from "../../components/opciones/Chip.astro";
import Subtitle from "../../components/opciones/Subtitle.astro";
import TitleSection from "../../components/opciones/TitleSection.astro";
import Section from "../../components/Section.astro";
import CodeIcon from "../../components/icons/CodeIcon.astro";
import DeployIcon from "../../components/icons/DeployIcon.astro";

// Consumir la API de GitHub y guardar los datos principales en una lista
type GithubRepo = {
  id: number;
  name: string;
  html_url: string;
  description: string | null;
  language: string | null;
  stargazers_count: number;
  forks_count: number;
  updated_at: string;
};

const response = await fetch("https://api.github.com/users/programmercito/repos");
const data: GithubRepo[] = await response.json();
const repos = data.map((repo: GithubRepo) => ({
  id: repo.id,
  name: repo.name,
  html_url: repo.html_url,
  description: repo.description,
  language: repo.language,
  stargazers_count: repo.stargazers_count,
  forks_count: repo.forks_count,
  updated_at: repo.updated_at
}));

---

<Section id="repositorios">
  <!-- Texto y botones -->
  <div class="order-2 md:order-1 text-center md:text-left">
    <TitleSection>Repositorios</TitleSection>

    <div class="grid gap-8 md:grid-cols-3 items-stretch">
      {
        repos.map((repo) => (
          <div class="w-full h-full flex">
            <div class="flex flex-col p-3 rounded-lg shadow-2xl w-full h-full transition-all duration-300 group hover:shadow-[0_8px_32px_0_rgba(0,0,0,0.35)] hover:scale-105">
              <>
                <div>
                  <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                    <div>
                      <Subtitle>{repo.name.toUpperCase()}</Subtitle>
                    </div>
                  </div>
                  <p class="text-justify leading-relaxed">{repo.description}</p>
                  <div class="flex flex-wrap gap-2 mt-3 justify-center">
                    {repo.language && <Chip text={repo.language} />}
                    <Chip text={`⭐ ${repo.stargazers_count}`} />
                    <Chip text={`🍴 ${repo.forks_count}`} />
                  </div>
                </div>
              </>
              <div class="flex flex-col items-center justify-center gap-4 md:flex-row md:justify-center mt-4">
                <BordeadoIcon link={repo.html_url}>
                  <CodeIcon />
                  Código
                </BordeadoIcon>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</Section>
